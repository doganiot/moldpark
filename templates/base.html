{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="csrf-token" content="{{ csrf_token }}">
    
    <!-- SEO ve Meta Tag'ler -->
    <meta name="description" content="{% block description %}MoldPark - Türkiye'nin en gelişmiş kulak kalıbı üretim ve yönetim sistemi. İşitme merkezleri ve üretici merkezler için profesyonel çözümler.{% endblock %}">
    <meta name="keywords" content="{% block keywords %}kulak kalıbı, işitme cihazı, kalıp üretimi, moldpark, işitme merkezi, kulak kalıbı üretimi{% endblock %}">
    <meta name="author" content="MoldPark">
    <meta name="robots" content="{% block robots %}index, follow{% endblock %}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="og:title" content="{% block og_title %}MoldPark - Kulak Kalıbı Yönetim Sistemi{% endblock %}">
    <meta property="og:description" content="{% block og_description %}MoldPark ile kulak kalıbı üretim sürecinizi dijitalleştirin. İşitme merkezleri ve üretici merkezler için tasarlanmış modern yönetim sistemi.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% static 'images/moldpark_logo.jpg' %}{% endblock %}">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{% block twitter_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="twitter:title" content="{% block twitter_title %}MoldPark - Kulak Kalıbı Yönetim Sistemi{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}MoldPark ile kulak kalıbı üretim sürecinizi dijitalleştirin. Profesyonel çözümler.{% endblock %}">
    <meta property="twitter:image" content="{% block twitter_image %}{% static 'images/moldpark_logo.jpg' %}{% endblock %}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical %}{{ request.build_absolute_uri }}{% endblock %}">
    
    <title>{% block title %}MoldPark - Kulak Kalıbı Yönetim Sistemi{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/custom.css' %}" rel="stylesheet">
    
    {% block extra_css %}{% endblock %}
    
    <!-- Accessibility ve Tema Rengi -->
    <meta name="theme-color" content="#4f46e5" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1e1b4b" media="(prefers-color-scheme: dark)">
    <meta name="color-scheme" content="light dark">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" as="style">
    <link rel="preload" href="{% static 'css/custom.css' %}" as="style">
</head>
<body>
    <!-- Skip Navigation Link for Accessibility -->
    <a href="#main-content" class="visually-hidden-focusable skip-link position-absolute top-0 start-0 z-3 btn btn-primary">
        Ana içeriğe geç
    </a>
    
    <!-- Modern Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top navbar-modern" role="navigation" aria-label="Ana navigasyon">
        <div class="container">
            {% if not user.is_authenticated or not user.center and not user.is_staff and not user.producer %}
            <a class="navbar-brand d-flex align-items-center" href="{% url 'core:home' %}" title="MoldPark Ana Sayfa">
            {% elif user.is_staff %}
            <a class="navbar-brand d-flex align-items-center" href="{% url 'center:admin_dashboard' %}" title="MoldPark Yönetim Paneli">
            {% elif user.producer %}
            <a class="navbar-brand d-flex align-items-center" href="{% url 'producer:dashboard' %}" title="MoldPark Üretici Paneli">
            {% else %}
            <a class="navbar-brand d-flex align-items-center" href="{% url 'center:dashboard' %}" title="MoldPark Merkez Paneli">
            {% endif %}
                <img src="{% static 'images/moldpark_logo.jpg' %}" alt="MoldPark Logo" 
                     class="me-2 brand-logo shadow-sm" 
                     style="width: 160px; height: 50px; object-fit: contain; border-radius: 8px;">
                {% if not user.is_authenticated or not user.center and not user.is_staff and not user.producer %}
                <span class="brand-text fw-bold fs-4 d-none d-sm-inline">MoldPark</span>
                {% endif %}
            </a>
            
            <!-- Quick Actions for Mobile -->
            <div class="d-flex d-lg-none align-items-center gap-2">
                {% if user.is_authenticated and user.center %}
                    <a href="{% url 'mold:mold_create' %}" class="btn btn-primary btn-sm" title="Yeni Kalıp Oluştur">
                        <i class="fas fa-plus" aria-hidden="true"></i>
                        <span class="d-none d-sm-inline ms-1">Yeni</span>
                    </a>
                {% endif %}
                
                <!-- Notifications for Mobile -->
                {% if user.is_authenticated and user.center or user.is_staff or user.is_superuser %}
                <div class="dropdown">
                    <button class="nav-link position-relative p-2 btn btn-link" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="Bildirimleri Göster">
                        <i class="fas fa-bell" aria-hidden="true"></i>
                        <span class="visually-hidden">Bildirimler</span>
                        {% with unread_count=user.notifications.unread.count %}
                        {% if unread_count > 0 %}
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge" aria-label="{{ unread_count }} okunmamış bildirim">
                            {{ unread_count }}
                        </span>
                        {% endif %}
                        {% endwith %}
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0" style="min-width: 300px;" aria-label="Bildirim listesi">
                        <li class="dropdown-header">
                            <h6 class="mb-0">Bildirimler</h6>
                        </li>
                        {% for notification in user.notifications.unread|slice:":3" %}
                            <li>
                                <a class="dropdown-item notification-item p-3 border-bottom" href="{% url 'center:mark_notification_read' notification.id %}" data-notification-id="{{ notification.id }}" title="{{ notification.verb }}">
                                    <div class="d-flex">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-circle text-primary" style="font-size: 0.5rem;" aria-hidden="true"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-2">
                                            <div class="fw-semibold text-dark small">{{ notification.verb|title }}</div>
                                            <div class="text-muted small">{{ notification.description|truncatechars:40 }}</div>
                                        </div>
                                    </div>
                                </a>
                            </li>
                        {% empty %}
                            <li class="dropdown-item text-center py-3">
                                <i class="fas fa-bell-slash text-muted mb-1" aria-hidden="true"></i>
                                <div class="text-muted small">Bildirim yok</div>
                            </li>
                        {% endfor %}
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-center text-primary small" href="{% url 'center:notification_list' %}" title="Tüm bildirimleri görüntüle">Tümünü Gör</a></li>
                    </ul>
                </div>
                {% endif %}
            </div>
            
            <button class="navbar-toggler custom-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Menüyü aç/kapat">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Mobile Menu Header -->
                <div class="d-lg-none border-bottom pb-3 mb-3 mt-3">
                    {% if user.is_authenticated %}
                        <div class="d-flex align-items-center">
                            <div class="user-avatar me-3">
                                <i class="fas fa-user-circle fs-2 text-primary"></i>
                            </div>
                            <div>
                                <div class="fw-bold">
                                    {% if user.producer %}
                                        {{ user.producer.company_name }}
                                    {% elif user.center %}
                                        {{ user.center.name }}
                                    {% else %}
                                        {{ user.username }}
                                    {% endif %}
                                </div>
                                <small class="text-muted">
                                    {% if user.producer %}
                                        Üretici Merkez
                                    {% elif user.center %}
                                        İşitme Merkezi
                                    {% elif user.is_staff %}
                                        Yönetici
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    {% endif %}
                </div>
                
                <ul class="navbar-nav me-auto">
                    {% if not user.is_authenticated or not user.center and not user.is_staff and not user.producer %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'core:home' %}">Ana Sayfa</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'core:pricing' %}">Fiyatlandırma</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'core:help_center' %}">Yardım Merkezi</a>
                    </li>
                    {% endif %}
                    
                    {% if user.is_authenticated %}
                        {% if user.is_staff or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'center:admin_dashboard' %}">Yönetim Paneli</a>
                            </li>
                        {% endif %}
                        
                        {% if user.producer %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'producer:dashboard' %}">Dashboard</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'producer:order_list' %}">Siparişler</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'producer:mold_list' %}">Kalıplar</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'producer:revision_requests' %}">
                                    Revizyonlar
                                    {% if pending_revision_requests > 0 %}
                                        <span class="badge bg-danger ms-1">{{ pending_revision_requests }}</span>
                                    {% endif %}
                                </a>
                            </li>
                        {% elif user.center %}
                            {% if not user.is_staff and not user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'center:dashboard' %}">Dashboard</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'mold:mold_list' %}">Kalıplarım</a>
                            </li>
                            <li class="nav-item d-lg-none">
                                <a class="nav-link text-primary fw-bold" href="{% url 'mold:mold_create' %}">
                                    <i class="fas fa-plus me-1"></i>Yeni Kalıp
                                </a>
                            </li>
                            <li class="nav-item d-none d-lg-block">
                                <a class="btn btn-primary ms-2" href="{% url 'mold:mold_create' %}">
                                    <i class="fas fa-plus me-1"></i>Yeni Kalıp
                                </a>
                            </li>
                            {% endif %}
                        {% endif %}
                        
                        <!-- Bildirimler -->
                        <li class="nav-item dropdown">
                            <a class="nav-link position-relative" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-bell"></i>
                                {% if unread_notifications > 0 %}
                                    <span class="badge bg-danger position-absolute top-0 start-100 translate-middle notification-badge" style="font-size: 0.6rem;">{{ unread_notifications }}</span>
                                {% endif %}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end shadow border-0" style="width: 320px; max-height: 400px; overflow-y: auto;">
                                <li class="dropdown-header d-flex justify-content-between align-items-center">
                                    <span>Bildirimler</span>
                                    {% if unread_notifications > 0 %}
                                        <span class="badge bg-primary">{{ unread_notifications }}</span>
                                    {% endif %}
                                </li>
                                {% if unread_notifications > 0 %}
                                <li>
                                    <button class="dropdown-item text-success" onclick="markAllNotificationsReadFromDropdown()" type="button">
                                        <i class="fas fa-check-double me-2"></i>Tümünü okundu işaretle
                                    </button>
                                </li>
                                {% endif %}
                                <li><hr class="dropdown-divider"></li>
                                
                                {% if user.simple_notifications.all|slice:":4" %}
                                    {% for notification in user.simple_notifications.all|slice:":4" %}
                                    <li>
                                        <a class="dropdown-item py-2 {% if not notification.is_read %}bg-light{% endif %}" href="{% url 'core:notification_redirect' notification.id %}">
                                            <div class="d-flex align-items-start">
                                                <i class="{{ notification.get_icon }} text-{{ notification.get_color }} me-2 mt-1 fs-6"></i>
                                                <div class="flex-grow-1">
                                                    <div class="fw-semibold small">{{ notification.title|truncatechars:25 }}</div>
                                                    <small class="text-muted">{{ notification.message|truncatechars:40 }}</small>
                                                    <div class="text-muted" style="font-size: 0.65rem;">
                                                        {{ notification.created_at|timesince }} önce
                                                        {% if not notification.is_read %}<span class="text-primary">• Yeni</span>{% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                    {% endfor %}
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item text-center text-primary small" href="{% url 'core:simple_notifications' %}">
                                            Tümünü görüntüle
                                        </a>
                                    </li>
                                {% else %}
                                    <li>
                                        <div class="dropdown-item-text text-center text-muted py-3">
                                            <i class="fas fa-bell-slash mb-2"></i>
                                            <br><small>Henüz bildirim yok</small>
                                        </div>
                                    </li>
                                {% endif %}
                            </ul>
                        </li>
                        
                        <!-- Mesajlar -->
                        <li class="nav-item">
                            <a class="nav-link position-relative" href="{% url 'core:message_list' %}">
                                <i class="fas fa-envelope"></i>
                                {% if unread_message_count > 0 %}
                                    <span class="badge bg-danger position-absolute top-0 start-100 translate-middle" style="font-size: 0.6rem;">{{ unread_message_count }}</span>
                                {% endif %}
                            </a>
                        </li>
                    {% endif %}
                </ul>
                <ul class="navbar-nav">
                    {% if user.is_authenticated %}
                        <!-- Kullanıcı -->
                        <li class="nav-item dropdown">
                            <a class="nav-link d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle fs-5"></i>
                                <span class="d-none d-md-inline ms-2">
                                    {% if user.producer %}
                                        {{ user.producer.company_name|truncatechars:12 }}
                                    {% elif user.center %}
                                        {{ user.center.name|truncatechars:12 }}
                                    {% else %}
                                        {{ user.username }}
                                    {% endif %}
                                </span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                                <li class="dropdown-header">
                                    <small class="text-muted">
                                        {% if user.producer %}Üretici{% elif user.center %}İşitme Merkezi{% elif user.is_staff %}Yönetici{% endif %}
                                    </small>
                                </li>
                                {% if user.producer %}
                                    <li><a class="dropdown-item" href="{% url 'producer:profile' %}"><i class="fas fa-user me-2"></i>Profil</a></li>
                                    <li><a class="dropdown-item" href="{% url 'producer:network_list' %}"><i class="fas fa-network-wired me-2"></i>Ağ Yönetimi</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="{% url 'producer:logout' %}"><i class="fas fa-sign-out-alt me-2"></i>Çıkış</a></li>
                                {% elif user.center %}
                                    <li><a class="dropdown-item" href="{% url 'center:profile' %}"><i class="fas fa-user me-2"></i>Profil</a></li>
                                    <li><a class="dropdown-item" href="{% url 'core:subscription_dashboard' %}"><i class="fas fa-credit-card me-2"></i>Abonelik</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="{% url 'account_logout' %}"><i class="fas fa-sign-out-alt me-2"></i>Çıkış</a></li>
                                {% else %}
                                    <li><a class="dropdown-item" href="{% url 'center:profile' %}"><i class="fas fa-user me-2"></i>Profil</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="{% url 'account_logout' %}"><i class="fas fa-sign-out-alt me-2"></i>Çıkış</a></li>
                                {% endif %}
                            </ul>
                        </li>
                    {% else %}
                        <!-- Guest User Actions -->
                        <li class="nav-item me-2">
                            <div class="dropdown">
                                <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-label="Kayıt seçenekleri menüsü" title="Kayıt türü seçin">
                                    <i class="fas fa-user-plus me-1"></i>Kayıt Ol
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0">
                                    <li>
                                        <a class="dropdown-item py-3" href="{% url 'account_signup' %}">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-clinic-medical me-3 text-primary fs-5"></i>
                                                <div>
                                                    <div class="fw-semibold">İşitme Merkezi</div>
                                                    <small class="text-muted">Kalıp siparişi vermek için</small>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item py-3" href="{% url 'producer:register' %}">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-industry me-3 text-success fs-5"></i>
                                                <div>
                                                    <div class="fw-semibold">Üretici Merkez</div>
                                                    <small class="text-muted">Kalıp üretimi yapmak için</small>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="nav-item">
                            <div class="dropdown">
                                <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-label="Giriş seçenekleri menüsü" title="Giriş türü seçin">
                                    <i class="fas fa-sign-in-alt me-1"></i>Giriş Yap
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0">
                                    <li>
                                        <a class="dropdown-item py-2" href="{% url 'account_login' %}">
                                            <i class="fas fa-clinic-medical me-2 text-primary"></i>
                                            İşitme Merkezi
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item py-2" href="{% url 'producer:login' %}">
                                            <i class="fas fa-industry me-2 text-success"></i>
                                            Üretici Merkez
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Navbar Bildirim JavaScript -->
    <script>
    function markAllNotificationsReadFromDropdown() {
        if (confirm('Tüm bildirimleri okundu olarak işaretlemek istediğinizden emin misiniz?')) {
            const csrfToken = getCsrfToken();
            if (!csrfToken) {
                showToast('CSRF token bulunamadı. Sayfayı yenileyin.', 'error');
                return;
            }
            
            fetch('/notifications/mark-all-read/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest',
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'csrfmiddlewaretoken=' + encodeURIComponent(csrfToken)
            })
            .then(response => {
                console.log('Response status:', response.status);
                
                // Yanıtın JSON olup olmadığını kontrol et
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    console.warn('Response is not JSON:', contentType);
                    return response.text().then(text => {
                        console.log('HTML Response:', text);
                        if (response.ok) {
                            // HTML yanıt alındıysa da başarılı kabul et
                            return { success: true, message: 'İşlem tamamlandı' };
                        }
                        throw new Error('Server returned HTML instead of JSON');
                    });
                }
                
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Navbar'daki badge'i gizle
                    const badge = document.querySelector('.notification-badge');
                    if (badge) {
                        badge.style.display = 'none';
                    }
                    
                    // Dropdown'u kapat
                    const dropdown = bootstrap.Dropdown.getInstance(document.getElementById('notificationDropdown'));
                    if (dropdown) {
                        dropdown.hide();
                    }
                    
                    // Başarı mesajı göster
                    showToast('Tüm bildirimler okundu olarak işaretlendi!', 'success');
                    
                    // Sayfayı yenile (güncel bildirimler için)
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                }
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                showToast('Bir hata oluştu: ' + error.message, 'error');
            });
        }
    }

    function getCsrfToken() {
        try {
            // Form'dan al
            const token = document.querySelector('[name=csrfmiddlewaretoken]');
            if (token && token.value) {
                return token.value;
            }
            
            // Meta tag'den al
            const metaToken = document.querySelector('meta[name="csrf-token"]');
            if (metaToken) {
                return metaToken.getAttribute('content');
            }
            
            // Cookie'den al
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'csrftoken') {
                    return value;
                }
            }
            
            // Script tag'den al (son seçenek)
            const scriptTags = document.querySelectorAll('script');
            for (let script of scriptTags) {
                const content = script.textContent || script.innerText;
                const match = content.match(/csrftoken['"]\s*:\s*['"]([^'"]+)['"]/);
                if (match) {
                    return match[1];
                }
            }
        } catch (error) {
            console.error('Error getting CSRF token:', error);
        }
        
        return '';
    }

    function showToast(message, type = 'info') {
        // Bootstrap toast yoksa basit alert kullan
        if (typeof bootstrap !== 'undefined' && bootstrap.Toast) {
            // Bootstrap toast kodu buraya eklenebilir
            alert(message);
        } else {
            alert(message);
        }
    }

    // Global anchor link koruma sistemi - DOMException hatalarını önler
    document.addEventListener('DOMContentLoaded', function() {
        // Tüm anchor linkler için global koruma
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                
                // Boş href veya sadece # içeren linkleri güvenli şekilde kontrol et
                if (!href || href === '#' || href.length <= 1) {
                    // Bootstrap dropdown, modal vb. için href="#" gerekli olabilir
                    // Bu durumda event'i durdurmuyoruz
                    return;
                }
                
                // Geçerli ID formatını kontrol et (HTML5 standartlarına uygun)
                if (!/^#[a-zA-Z][\w-]*$/.test(href)) {
                    console.warn('Invalid anchor href:', href);
                    e.preventDefault();
                    return;
                }
                
                try {
                    // querySelector'i güvenli şekilde kullan
                    const target = document.querySelector(href);
                    if (target) {
                        e.preventDefault();
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                } catch (error) {
                    console.error('Error in anchor link handler:', error, 'href:', href);
                    e.preventDefault();
                }
            });
        });
    });
    </script>

    <!-- Messages -->
    {% if messages %}
        <div class="container mt-3">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm border-0 rounded-3">
                    <div class="d-flex align-items-center">
                        {% if message.tags == 'success' %}
                            <i class="fas fa-check-circle me-2 text-success"></i>
                        {% elif message.tags == 'error' or message.tags == 'danger' %}
                            <i class="fas fa-exclamation-circle me-2 text-danger"></i>
                        {% elif message.tags == 'warning' %}
                            <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                        {% else %}
                            <i class="fas fa-info-circle me-2 text-info"></i>
                        {% endif %}
                        <div class="flex-grow-1">{{ message }}</div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Uyarıyı kapat" title="Uyarıyı kapat"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Content -->
    <main id="main-content" class="content-wrapper" role="main">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="glass-card mt-auto">
        <div class="container py-5">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <img src="{% static 'images/moldpark_logo.jpg' %}" alt="MoldPark" class="me-2" style="height: 40px; border-radius: 8px;">
                        <h4 class="mb-0 gradient-text">MoldPark</h4>
                    </div>
                    <p class="text-muted">Profesyonel kulak kalıbı üretim ve yönetim sistemi ile işitme sektöründe yenilikçi çözümler sunuyoruz.</p>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-muted hover-primary">
                            <i class="fab fa-twitter fs-5"></i>
                        </a>
                        <a href="#" class="text-muted hover-primary">
                            <i class="fab fa-linkedin fs-5"></i>
                        </a>
                        <a href="#" class="text-muted hover-primary">
                            <i class="fab fa-instagram fs-5"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">Platform</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="{% url 'core:home' %}" class="text-muted text-decoration-none hover-primary">Ana Sayfa</a></li>
                        <li class="mb-2"><a href="{% url 'core:pricing' %}" class="text-muted text-decoration-none hover-primary">Fiyatlandırma</a></li>
                        <li class="mb-2"><a href="{% url 'core:features' %}" class="text-muted text-decoration-none hover-primary">Özellikler</a></li>
                        <li class="mb-2"><a href="#register" class="text-muted text-decoration-none hover-primary">Kayıt Ol</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">Hizmetler</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><span class="text-muted">AI Modelleme</span></li>
                        <li class="mb-2"><span class="text-muted">Hızlı Üretim</span></li>
                        <li class="mb-2"><span class="text-muted">Kalite Kontrol</span></li>
                        <li class="mb-2"><span class="text-muted">7/24 Destek</span></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">Destek</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="{% url 'core:contact' %}" class="text-muted text-decoration-none hover-primary">İletişim</a></li>
                        <li class="mb-2"><a href="{% url 'core:help_center' %}" class="text-muted text-decoration-none hover-primary">Yardım Merkezi</a></li>
                        <li class="mb-2"><a href="{% url 'core:documentation' %}" class="text-muted text-decoration-none hover-primary">Dokümantasyon</a></li>
                        <li class="mb-2"><span class="text-muted">API</span></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">İletişim</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-envelope me-2 text-primary"></i>
                            <small class="text-muted">info@moldpark.com</small>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-phone me-2 text-primary"></i>
                            <small class="text-muted">+90 (544) 221 92 84</small>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                            <small class="text-muted">Trabzon, Türkiye</small>
                        </li>
                    </ul>
                </div>
            </div>
            <hr class="my-4 opacity-25">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="text-muted mb-0">&copy; {% now "Y" %} MoldPark. Tüm hakları saklıdır.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <small class="text-muted">Türkiye'nin en güvenilir kulak kalıbı platformu</small>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{% static 'js/custom.js' %}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html> 