{% load i18n %}
{% load static %}
{% load moldpark_extras %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="csrf-token" content="{{ csrf_token }}">
    
    <!-- SEO ve Meta Tag'ler -->
    <meta name="description" content="{% block description %}MoldPark - TÃ¼rkiye'nin en geliÅŸmiÅŸ kulak kalÄ±bÄ± Ã¼retim ve yÃ¶netim sistemi. Ä°ÅŸitme merkezleri ve Ã¼retici merkezler iÃ§in profesyonel Ã§Ã¶zÃ¼mler.{% endblock %}">
    <meta name="keywords" content="{% block keywords %}kulak kalÄ±bÄ±, iÅŸitme cihazÄ±, kalÄ±p Ã¼retimi, moldpark, iÅŸitme merkezi, kulak kalÄ±bÄ± Ã¼retimi{% endblock %}">
    <meta name="author" content="MoldPark">
    <meta name="robots" content="{% block robots %}index, follow{% endblock %}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="og:title" content="{% block og_title %}MoldPark - Kulak KalÄ±bÄ± YÃ¶netim Sistemi{% endblock %}">
    <meta property="og:description" content="{% block og_description %}MoldPark ile kulak kalÄ±bÄ± Ã¼retim sÃ¼recinizi dijitalleÅŸtirin. Ä°ÅŸitme merkezleri ve Ã¼retici merkezler iÃ§in tasarlanmÄ±ÅŸ modern yÃ¶netim sistemi.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% static 'images/moldpark_logo.jpg' %}{% endblock %}">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{% block twitter_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="twitter:title" content="{% block twitter_title %}MoldPark - Kulak KalÄ±bÄ± YÃ¶netim Sistemi{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}MoldPark ile kulak kalÄ±bÄ± Ã¼retim sÃ¼recinizi dijitalleÅŸtirin. Profesyonel Ã§Ã¶zÃ¼mler.{% endblock %}">
    <meta property="twitter:image" content="{% block twitter_image %}{% static 'images/moldpark_logo.jpg' %}{% endblock %}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical %}{{ request.build_absolute_uri }}{% endblock %}">
    
    <title>{% block title %}MoldPark - Kulak KalÄ±bÄ± YÃ¶netim Sistemi{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/custom.css' %}?v=4.0" rel="stylesheet">
    
    {% block extra_css %}{% endblock %}
    
    <!-- Accessibility ve Tema Rengi -->
    <meta name="theme-color" content="#4f46e5" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1e1b4b" media="(prefers-color-scheme: dark)">
    <meta name="color-scheme" content="light dark">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" as="style">
    <link rel="preload" href="{% static 'css/custom.css' %}?v=4.0" as="style">
    <link rel="preload" href="https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7.woff2" as="font" type="font/woff2" crossorigin>
</head>
<body>
    <!-- Skip Navigation Link for Accessibility -->
    <a href="#main-content" class="visually-hidden-focusable skip-link position-absolute top-0 start-0 z-3 btn btn-primary">
        Ana iÃ§eriÄŸe geÃ§
    </a>
    
    <!-- Modern Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top navbar-modern" role="navigation" aria-label="Ana navigasyon">
        <div class="container">
            {% if not 'login' in request.path and not 'signup' in request.path and not 'password_reset' in request.path and not 'account' in request.path %}
                {% if user.is_staff %}
                <a class="navbar-brand d-flex align-items-center" href="{% url 'center:admin_dashboard' %}" title="YÃ¶netim Paneli">
                {% elif user.producer %}
                <a class="navbar-brand d-flex align-items-center" href="{% url 'producer:dashboard' %}" title="Ãœretici Paneli">
                {% elif user.center %}
                <a class="navbar-brand d-flex align-items-center" href="{% url 'center:dashboard' %}" title="Merkez Paneli">
                {% else %}
                <a class="navbar-brand d-flex align-items-center" href="{% url 'core:home' %}" title="Ana Sayfa">
                {% endif %}
                    <img src="{% static 'images/moldpark_logo.jpg' %}" alt="MoldPark Logo" 
                         class="me-2 brand-logo shadow-lg" 
                         style="width: 120px; height: 50px; object-fit: contain; border-radius: 8px;">
                </a>
            {% endif %}
            
            <!-- Mobile Quick Actions -->
            <div class="d-flex d-lg-none align-items-center gap-2">
                {% if user.is_authenticated %}
                    <!-- Yeni KalÄ±p butonu (sadece iÅŸitme merkezleri iÃ§in) -->
                    {% if user.center %}
                        <a href="{% url 'mold:mold_create' %}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus"></i>
                        </a>
                    {% endif %}
                    
                    <!-- Bildirimler (mobile) -->
                    <div class="dropdown">
                        <button class="btn btn-link p-1" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-bell"></i>
                            {% if unread_notifications > 0 %}
                                <span class="position-absolute translate-middle badge rounded-pill bg-danger" style="top: 8px; left: 20px; font-size: 0.6rem;">
                                    {{ unread_notifications }}
                                </span>
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li class="dropdown-header">Bildirimler</li>
                            <li><a class="dropdown-item" href="{% url 'core:simple_notifications' %}">TÃ¼m Bildirimler</a></li>
                        </ul>
                    </div>
                {% endif %}
            </div>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Mobile User Header -->
                <div class="d-lg-none border-bottom pb-3 mb-3 mt-3">
                    {% if user.is_authenticated %}
                        <div class="d-flex align-items-center">
                            <i class="fas fa-user-circle fs-2 text-primary me-3"></i>
                            <div>
                                <div class="fw-bold">
                                    {% if user.producer %}
                                        {{ user.producer.company_name }}
                                    {% elif user.center %}
                                        {{ user.center.name }}
                                    {% else %}
                                        {{ user.username }}
                                    {% endif %}
                                </div>
                                <small class="text-muted">
                                    {% if user.producer %}Ãœretici Merkez
                                    {% elif user.center %}Ä°ÅŸitme Merkezi
                                    {% elif user.is_staff %}Sistem YÃ¶neticisi
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    {% endif %}
                </div>
                
                <ul class="navbar-nav me-auto">
                    {% if not user.is_authenticated %}
                        <!-- Misafir -->
                        <li class="nav-item"><a class="nav-link" href="{% url 'core:pricing' %}">{% trans "FiyatlandÄ±rma" %}</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'core:help_center' %}">{% trans "YardÄ±m Merkezi" %}</a></li>
                    {% else %}
                        {% if user.is_staff %}
                            <!-- Admin -->
                            <li class="nav-item"><a class="nav-link" href="{% url 'center:admin_dashboard' %}"><i class="fas fa-tachometer-alt me-1"></i>{% trans "YÃ¶netim Paneli" %}</a></li>
                        {% elif user.producer %}
                            <!-- Ãœretici -->
                            <li class="nav-item"><a class="nav-link" href="{% url 'producer:dashboard' %}"><i class="fas fa-home me-1"></i>{% trans "Dashboard" %}</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'producer:order_list' %}"><i class="fas fa-list-alt me-1"></i>{% trans "SipariÅŸler" %}</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'producer:mold_list' %}"><i class="fas fa-cube me-1"></i>{% trans "KalÄ±plar" %}</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'producer:revision_requests' %}"><i class="fas fa-edit me-1"></i>{% trans "Revizyonlar" %} {% if pending_revision_requests > 0 %}<span class="badge bg-danger ms-1">{{ pending_revision_requests }}</span>{% endif %}</a></li>
                        {% else %}
                            <!-- Ä°ÅŸitme Merkezi -->
                            <li class="nav-item"><a class="nav-link" href="{% url 'center:dashboard' %}"><i class="fas fa-home me-1"></i>{% trans "Dashboard" %}</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'mold:mold_list' %}"><i class="fas fa-cube me-1"></i>{% trans "KalÄ±plarÄ±m" %}</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'center:network_management' %}"><i class="fas fa-network-wired me-1"></i>{% trans "Ãœretici AÄŸlarÄ±" %}</a></li>
                        {% endif %}
                        <!-- Bildirimler -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle position-relative" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-bell me-1"></i>{% trans "Bildirimler" %}
                                {% if unread_notifications > 0 %}<span class="badge bg-danger ms-1">{{ unread_notifications }}</span>{% endif %}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end shadow border-0" style="width: 320px; max-height: 400px; overflow-y: auto;">
                                <li class="dropdown-header d-flex justify-content-between align-items-center">
                                    <span>{% trans "Bildirimler" %}</span>
                                    {% if unread_notifications > 0 %}<span class="badge bg-primary">{{ unread_notifications }}</span>{% endif %}
                                </li>
                                {% if unread_notifications > 0 %}
                                    <li><button class="dropdown-item text-success" onclick="markAllNotificationsReadFromDropdown()" type="button"><i class="fas fa-check-double me-2"></i>{% trans "TÃ¼mÃ¼nÃ¼ okundu iÅŸaretle" %}</button></li>
                                    <li><hr class="dropdown-divider"></li>
                                {% endif %}
                                {% for notification in user.simple_notifications.all|slice:":4" %}
                                    <li>
                                        <a class="dropdown-item py-2 {% if not notification.is_read %}bg-light{% endif %}" href="{% url 'core:notification_redirect' notification.id %}">
                                            <div class="d-flex align-items-start">
                                                <i class="{{ notification.get_icon }} text-{{ notification.get_color }} me-2 mt-1 fs-6"></i>
                                                <div class="flex-grow-1">
                                                    <div class="fw-semibold small">{{ notification.title|truncatechars:25 }}</div>
                                                    <small class="text-muted">{{ notification.message|truncatechars:40 }}</small>
                                                    <div class="text-muted" style="font-size: 0.65rem;">{{ notification.created_at|timesince }} Ã¶nce {% if not notification.is_read %}<span class="text-primary">â€¢ Yeni</span>{% endif %}</div>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                {% empty %}
                                    <li><div class="dropdown-item-text text-center text-muted py-3"><i class="fas fa-bell-slash mb-2"></i><br><small>HenÃ¼z bildirim yok</small></div></li>
                                {% endfor %}
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-center text-primary small" href="{% url 'core:simple_notifications' %}">TÃ¼mÃ¼nÃ¼ gÃ¶rÃ¼ntÃ¼le</a></li>
                            </ul>
                        </li>
                    {% endif %}
                </ul>
                
                <!-- SaÄŸ taraf - Yeni KalÄ±p butonu ve KullanÄ±cÄ± menÃ¼sÃ¼ -->
                <ul class="navbar-nav">
                    <!-- Language Switcher -->
                    <li class="nav-item dropdown me-2">
                        <a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-globe me-1"></i>
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'tr' %}ðŸ‡¹ðŸ‡· TR{% elif LANGUAGE_CODE == 'en' %}ðŸ‡ºðŸ‡¸ EN{% else %}{{ LANGUAGE_CODE|upper }}{% endif %}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
                            {% get_available_languages as LANGUAGES %}
                            {% get_language_info_list for LANGUAGES as languages %}
                            <!-- Debug: Current language: {{ LANGUAGE_CODE }} -->
                            {% for language in languages %}
                                <li>
                                    <!-- Debug: Language: {{ language.code }} - {{ language.name_local }} -->
                                    <form action="{% url 'set_language' %}" method="post" style="display: inline;" onsubmit="return validateLanguageForm(this);">
                                        {% csrf_token %}
                                        <input name="next" type="hidden" value="{{ request.get_full_path }}" />
                                        <input name="language" type="hidden" value="{{ language.code }}" />
                                        <button type="submit" class="dropdown-item {% if language.code == LANGUAGE_CODE %}active{% endif %}">
                                            {% if language.code == 'tr' %}ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e{% elif language.code == 'en' %}ðŸ‡ºðŸ‡¸ English{% else %}{{ language.name_local|title }}{% endif %}
                                        </button>
                                    </form>
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                    
                    {% if user.is_authenticated %}
                        <!-- Yeni KalÄ±p butonu (sadece iÅŸitme merkezleri iÃ§in) -->
                        {% if user.center %}
                            <li class="nav-item me-2">
                                <a class="btn btn-primary" href="{% url 'mold:mold_create' %}">
                                    <i class="fas fa-plus me-1"></i>Yeni KalÄ±p
                                </a>
                            </li>
                        {% endif %}
                        
                        <!-- KullanÄ±cÄ± dropdown menÃ¼sÃ¼ -->
                        <li class="nav-item dropdown">
                            <a class="nav-link d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle fs-5"></i>
                                <span class="d-none d-md-inline ms-2">
                                    {% if user.producer %}
                                        {{ user.producer.company_name|truncatechars:15 }}
                                    {% elif user.center %}
                                        {{ user.center.name|truncatechars:15 }}
                                    {% else %}
                                        {{ user.username }}
                                    {% endif %}
                                </span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                                <li class="dropdown-header">
                                    <small class="text-muted">
                                        {% if user.producer %}Ãœretici Merkez{% elif user.center %}Ä°ÅŸitme Merkezi{% elif user.is_staff %}Sistem YÃ¶neticisi{% endif %}
                                    </small>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                
                                {% if user.producer %}
                                    <li><a class="dropdown-item" href="{% url 'producer:profile' %}"><i class="fas fa-user me-2"></i>{% trans "Profil AyarlarÄ±" %}</a></li>
                                    <li><a class="dropdown-item" href="{% url 'producer:network_list' %}"><i class="fas fa-network-wired me-2"></i>{% trans "AÄŸ YÃ¶netimi" %}</a></li>
                                {% elif user.center %}
                                    <li><a class="dropdown-item" href="{% url 'center:profile' %}"><i class="fas fa-user me-2"></i>{% trans "Profil AyarlarÄ±" %}</a></li>
                                    <li><a class="dropdown-item" href="{% url 'core:subscription_dashboard' %}"><i class="fas fa-credit-card me-2"></i>{% trans "Abonelik YÃ¶netimi" %}</a></li>
                                {% else %}
                                    <li><a class="dropdown-item" href="{% url 'center:profile' %}"><i class="fas fa-user me-2"></i>{% trans "Profil AyarlarÄ±" %}</a></li>
                                {% endif %}
                                
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{% url 'core:help_center' %}"><i class="fas fa-question-circle me-2"></i>{% trans "YardÄ±m Merkezi" %}</a></li>
                                <li><hr class="dropdown-divider"></li>
                                
                                {% if user.producer %}
                                    <li><a class="dropdown-item text-danger" href="{% url 'producer:logout' %}"><i class="fas fa-sign-out-alt me-2"></i>{% trans "Ã‡Ä±kÄ±ÅŸ Yap" %}</a></li>
                                {% else %}
                                    <li><a class="dropdown-item text-danger" href="{% url 'account_logout' %}"><i class="fas fa-sign-out-alt me-2"></i>{% trans "Ã‡Ä±kÄ±ÅŸ Yap" %}</a></li>
                                {% endif %}
                            </ul>
                        </li>
                    {% else %}
                        <!-- Misafir kullanÄ±cÄ±lar iÃ§in kayÄ±t ve giriÅŸ -->
                        <li class="nav-item me-2">
                            <div class="dropdown">
                                <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-user-plus me-1"></i>{% trans "KayÄ±t Ol" %}
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0">
                                    <li>
                                        <a class="dropdown-item py-3" href="{% url 'account_signup' %}">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-clinic-medical me-3 text-primary fs-5"></i>
                                                <div>
                                                    <div class="fw-semibold">{% trans "Ä°ÅŸitme Merkezi" %}</div>
                                                    <small class="text-muted">{% trans "KalÄ±p sipariÅŸi vermek iÃ§in" %}</small>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item py-3" href="{% url 'producer:register' %}">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-industry me-3 text-success fs-5"></i>
                                                <div>
                                                    <div class="fw-semibold">{% trans "Ãœretici Merkez" %}</div>
                                                    <small class="text-muted">{% trans "KalÄ±p Ã¼retimi yapmak iÃ§in" %}</small>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-light" href="{% url 'account_login' %}">
                                <i class="fas fa-sign-in-alt me-1"></i>{% trans "GiriÅŸ Yap" %}
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Navbar Bildirim JavaScript -->
    <script>
    function markAllNotificationsReadFromDropdown() {
        if (confirm('{% trans "TÃ¼m bildirimleri okundu olarak iÅŸaretlemek istediÄŸinizden emin misiniz?" %}')) {
            const csrfToken = getCsrfToken();
            if (!csrfToken) {
                showToast('CSRF token bulunamadÄ±. SayfayÄ± yenileyin.', 'error');
                return;
            }
            
            fetch('/notifications/mark-all-read/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest',
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'csrfmiddlewaretoken=' + encodeURIComponent(csrfToken)
            })
            .then(response => {
                console.log('Response status:', response.status);
                
                // YanÄ±tÄ±n JSON olup olmadÄ±ÄŸÄ±nÄ± kontrol et
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    console.warn('Response is not JSON:', contentType);
                    return response.text().then(text => {
                        console.log('HTML Response:', text);
                        if (response.ok) {
                            // HTML yanÄ±t alÄ±ndÄ±ysa da baÅŸarÄ±lÄ± kabul et
                            return { success: true, message: 'Ä°ÅŸlem tamamlandÄ±' };
                        }
                        throw new Error('Server returned HTML instead of JSON');
                    });
                }
                
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Navbar'daki badge'i gizle
                    const badge = document.querySelector('.notification-badge');
                    if (badge) {
                        badge.style.display = 'none';
                    }
                    
                    // Dropdown'u kapat
                    const dropdown = bootstrap.Dropdown.getInstance(document.getElementById('notificationDropdown'));
                    if (dropdown) {
                        dropdown.hide();
                    }
                    
                    // BaÅŸarÄ± mesajÄ± gÃ¶ster
                    showToast('TÃ¼m bildirimler okundu olarak iÅŸaretlendi!', 'success');
                    
                    // SayfayÄ± yenile (gÃ¼ncel bildirimler iÃ§in)
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                }
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                showToast('Bir hata oluÅŸtu: ' + error.message, 'error');
            });
        }
    }

    function getCsrfToken() {
        try {
            // Form'dan al
            const token = document.querySelector('[name=csrfmiddlewaretoken]');
            if (token && token.value) {
                return token.value;
            }
            
            // Meta tag'den al
            const metaToken = document.querySelector('meta[name="csrf-token"]');
            if (metaToken) {
                return metaToken.getAttribute('content');
            }
            
            // Cookie'den al
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'csrftoken') {
                    return value;
                }
            }
            
            // Script tag'den al (son seÃ§enek)
            const scriptTags = document.querySelectorAll('script');
            for (let script of scriptTags) {
                const content = script.textContent || script.innerText;
                const match = content.match(/csrftoken['"]\s*:\s*['"]([^'"]+)['"]/);
                if (match) {
                    return match[1];
                }
            }
        } catch (error) {
            console.error('Error getting CSRF token:', error);
        }
        
        return '';
    }

    function showToast(message, type = 'info') {
        // Bootstrap toast yoksa basit alert kullan
        if (typeof bootstrap !== 'undefined' && bootstrap.Toast) {
            // Bootstrap toast kodu buraya eklenebilir
            alert(message);
        } else {
            alert(message);
        }
    }

    // Global anchor link koruma sistemi - DOMException hatalarÄ±nÄ± Ã¶nler
    document.addEventListener('DOMContentLoaded', function() {
        // TÃ¼m anchor linkler iÃ§in global koruma
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                
                // BoÅŸ href veya sadece # iÃ§eren linkleri gÃ¼venli ÅŸekilde kontrol et
                if (!href || href === '#' || href.length <= 1) {
                    // Bootstrap dropdown, modal vb. iÃ§in href="#" gerekli olabilir
                    // Bu durumda event'i durdurmuyoruz
                    return;
                }
                
                // GeÃ§erli ID formatÄ±nÄ± kontrol et (HTML5 standartlarÄ±na uygun)
                if (!/^#[a-zA-Z][\w-]*$/.test(href)) {
                    console.warn('Invalid anchor href:', href);
                    e.preventDefault();
                    return;
                }
                
                try {
                    // querySelector'i gÃ¼venli ÅŸekilde kullan
                    const target = document.querySelector(href);
                    if (target) {
                        e.preventDefault();
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                } catch (error) {
                    console.error('Error in anchor link handler:', error, 'href:', href);
                    e.preventDefault();
                }
            });
        });
    });
    </script>

    <!-- Messages -->
    {% if messages %}
        <div class="container mt-3">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm border-0 rounded-3">
                    <div class="d-flex align-items-center">
                        {% if message.tags == 'success' %}
                            <i class="fas fa-check-circle me-2 text-success"></i>
                        {% elif message.tags == 'error' or message.tags == 'danger' %}
                            <i class="fas fa-exclamation-circle me-2 text-danger"></i>
                        {% elif message.tags == 'warning' %}
                            <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                        {% else %}
                            <i class="fas fa-info-circle me-2 text-info"></i>
                        {% endif %}
                        <div class="flex-grow-1">{{ message }}</div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="UyarÄ±yÄ± kapat" title="UyarÄ±yÄ± kapat"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Content -->
    <main id="main-content" class="content-wrapper" role="main">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="glass-card mt-auto">
        <div class="container py-5">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <img src="{% static 'images/moldpark_logo.jpg' %}" alt="MoldPark" class="me-2" style="height: 40px; border-radius: 8px;">
                        <h4 class="mb-0 gradient-text">MoldPark</h4>
                    </div>
                    <p class="text-muted">{% trans "Profesyonel kulak kalÄ±bÄ± Ã¼retim ve yÃ¶netim sistemi ile iÅŸitme sektÃ¶rÃ¼nde yenilikÃ§i Ã§Ã¶zÃ¼mler sunuyoruz." %}</p>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-muted hover-primary">
                            <i class="fab fa-twitter fs-5"></i>
                        </a>
                        <a href="#" class="text-muted hover-primary">
                            <i class="fab fa-linkedin fs-5"></i>
                        </a>
                        <a href="#" class="text-muted hover-primary">
                            <i class="fab fa-instagram fs-5"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">{% trans "Platform" %}</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="{% url 'core:home' %}" class="text-muted text-decoration-none hover-primary">{% trans "Ana Sayfa" %}</a></li>
                        <li class="mb-2"><a href="{% url 'core:pricing' %}" class="text-muted text-decoration-none hover-primary">{% trans "FiyatlandÄ±rma" %}</a></li>
                        <li class="mb-2"><a href="{% url 'core:features' %}" class="text-muted text-decoration-none hover-primary">{% trans "Ã–zellikler" %}</a></li>
                        <li class="mb-2"><a href="#register" class="text-muted text-decoration-none hover-primary">{% trans "KayÄ±t Ol" %}</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">{% trans "Hizmetler" %}</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><span class="text-muted">{% trans "AI Modelleme" %}</span></li>
                        <li class="mb-2"><span class="text-muted">{% trans "HÄ±zlÄ± Ãœretim" %}</span></li>
                        <li class="mb-2"><span class="text-muted">{% trans "Kalite Kontrol" %}</span></li>
                        <li class="mb-2"><span class="text-muted">{% trans "7/24 Destek" %}</span></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">{% trans "Destek" %}</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="{% url 'core:contact' %}" class="text-muted text-decoration-none hover-primary">{% trans "Ä°letiÅŸim" %}</a></li>
                        <li class="mb-2"><a href="{% url 'core:help_center' %}" class="text-muted text-decoration-none hover-primary">{% trans "YardÄ±m Merkezi" %}</a></li>
                        <li class="mb-2"><a href="{% url 'core:documentation' %}" class="text-muted text-decoration-none hover-primary">{% trans "DokÃ¼mantasyon" %}</a></li>
                        <li class="mb-2"><span class="text-muted">API</span></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">{% trans "Ä°letiÅŸim" %}</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-envelope me-2 text-primary"></i>
                            <small class="text-muted">info@moldpark.com</small>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-phone me-2 text-primary"></i>
                            <small class="text-muted">+90 (544) 221 92 84</small>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                            <small class="text-muted">Trabzon, TÃ¼rkiye</small>
                        </li>
                    </ul>
                </div>
            </div>
            <hr class="my-4 opacity-25">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="text-muted mb-0">&copy; {% now "Y" %} MoldPark. {% trans "TÃ¼m haklarÄ± saklÄ±dÄ±r." %}</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <small class="text-muted">{% trans "Global gÃ¼venilir kulak kalÄ±bÄ± platformu" %}</small>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{% static 'js/custom.js' %}"></script>
    
    <!-- Language Switcher Validation -->
    <script>
        function validateLanguageForm(form) {
            const languageInput = form.querySelector('input[name="language"]');
            const allowedLanguages = ['tr', 'en'];
            
            console.log('Language form submission:', {
                languageValue: languageInput ? languageInput.value : 'undefined',
                formAction: form.action,
                nextValue: form.querySelector('input[name="next"]')?.value
            });
            
            if (!languageInput || !allowedLanguages.includes(languageInput.value)) {
                console.error('Invalid language code:', languageInput ? languageInput.value : 'undefined');
                return false;
            }
            
            return true;
        }
        
        // Prevent any invalid language submissions
        document.addEventListener('DOMContentLoaded', function() {
            const languageForms = document.querySelectorAll('form[action*="set_language"]');
            languageForms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    if (!validateLanguageForm(this)) {
                        e.preventDefault();
                        console.error('Language form validation failed');
                    }
                });
            });
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html> 